<!DOCTYPE html>
<html>

<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>查看討論版 ｜ NCU MIS SA</title>

    <!-- Favicons -->
    <link href="statics/icon/favicon.ico" rel="icon" />
    <link href="statics/img/apple-touch-icon.png" rel="apple-touch-icon" />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link href="statics/vendor/aos/aos.css" rel="stylesheet" />
    <link
      href="statics/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="statics/vendor/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      href="statics/vendor/glightbox/css/glightbox.min.css"
      rel="stylesheet"
    />
    <link href="statics/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link href="statics/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />

    <link
      rel="stylesheet"
      href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
      integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p"
      crossorigin="anonymous"
    />
    <script src="statics/js/jquery-3.4.1.min.js"></script>
    <!-- Template Main CSS File -->
    <link href="statics/css/style.css" rel="stylesheet" />

    <!-- =======================================================
  * Template Name: FlexStart - v1.9.0
  * Template URL: https://bootstrapmade.com/flexstart-bootstrap-startup-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
    <script>
      var name;
      var role;
      function checkID() {
        $.ajax({
          type: "GET",
          url: "api/login.do",
          crossDomain: true,
          cache: false,
          dataType: "json",
          timeout: 5000,
          success: function (response) {
            if (response.status == 200) {
              if (response.response.status == "login") {
                //未登入
                name = response.response.name;
                role = response.response.role;
                if (role == "1" || role == "2") {
                } else {
                  //notAdmin();
                }
              } else {
                //notLogin();
              }
              console.log(response);
            }
          },
          error: function () {
            alert("無法連線到伺服器！");
          },
        });
      }
      checkID();
      //alert(name);
      function notLogin() {
        alert("請先登入!");
        window.location = "login.html";
      }
      function notAdmin() {
        alert("你不是管理員!");
        window.location = "index.html";
      }
    </script>
  </head>

  <body>
    <!-- ======= Header ======= -->
    <header id="header" class="header fixed-top">
      <div
        class="container-fluid container-xl d-flex align-items-center justify-content-between"
      >
        <a href="index.html" class="logo d-flex align-items-center">
          <img src="statics/img/logo.png" alt="" />
          <span>宿舍管理系統</span>
        </a>

        <nav id="navbar" class="navbar">
          <ul>
            <li><a class="nav-link scrollto active" href="index.html#hero">首頁</a></li>
            <li><a class="nav-link scrollto" href="index.html#services">選單</a></li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                其他功能
              </a>

              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                <li>
                  <a
                    class="nav-link dropdown-item scrollto"
                    href="index.html#bulletin_board"
                    >公告欄</a
                  >
                </li>
                <li>
                  <a
                    class="nav-link dropdown-item scrollto"
                    href="discussion_board.html"
                    >討論版</a
                  >
                </li>
                <li>
                  <a class="nav-link dropdown-item scrollto" href="payment.html"
                    >宿舍繳費</a
                  >
                </li>
                <li>
                  <a
                    class="nav-link dropdown-item scrollto"
                    href="dormManagement.html"
                    >宿舍報修</a
                  >
                </li>
                <li>
                  <a
                    class="nav-link dropdown-item scrollto"
                    href="check_in.html"
                    >報到手續</a
                  >
                </li>
                <li>
                  <a
                    class="nav-link dropdown-item scrollto"
                    href="check_out.html"
                    >退宿手續</a
                  >
                </li>
                <li>
                  <hr class="dropdown-divider admin" />
                </li>
                <li>
                  <a
                    class="nav-link dropdown-item scrollto admin"
                    href="member.html"
                    >會員管理</a
                  >
                </li>
                <li>
                  <a
                    class="nav-link dropdown-item scrollto admin"
                    href="bulletinboard.html"
                    >公告欄管理</a
                  >
                </li>
              </ul>
            </li>

            <div id="loginOrNot"></div>
          </ul>
          <i class="bi bi-list mobile-nav-toggle"></i>
        </nav>
        <!-- .navbar -->
      </div>
    </header>
    <!-- End Header -->
    
    
   <section>
   <!--"container"為固定置中,請參考 http://kkbruce.tw/Bootstrap/Scaffolding 佈局篇-->
   
   <header class="section-header">
        <h2>公告欄管理</h2>
        <p id="fix_id" style="color: red"></p>
        <p>以下為公告欄管理</p>
      </header>
      
   <div class="container">
   <!--class="table table-bordered table-condensed"請參考 http://kkbruce.tw/Bootstrap/BaseCSS#tables -->
     <table width="1200" border="0" class="table table-bordered table-condensed">
       <tr>
          <div align="center">       
             <!-- 請參考 http://kkbruce.tw/Bootstrap/BaseCSS#buttons -->
             <button class="btn btn-primary" type="button" onClick="window.location='addbulletinboard.html'">新增公告</button>
         </div>
       </tr>
       <tr>
         <table class="table "id="table">
                <thead>
                    <tr>
                        <th>項次</th>
                        <th>標題</th>
                        <th>內容</th>
                        <th>更新時間</th>
                        <th>功能</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
       </tr>
     </table>
   </section>
   
     
     <script type="text/javascript">
   //account function
     function checkLogin(){
   	    $.ajax({
   	            type: "GET",
   	            url: "api/login.do",
   	            crossDomain: true,
   	            cache: false,
   	            dataType: 'json',
   	            timeout: 5000,
   	            success: function (response) {
   	             if (response.status == 200) {
   	              

   	              let inner_html = "";
   	              if (response.response.status != "login") {
   	                //未登入
   	                inner_html +=
   	                  '<li class="nav-item"><a class="getstarted scrollto" href="login.html">登入 / 註冊</a></li>';
   	              } else {
   	                //登入
   	                if (
   	                  response.response.role == "1" ||
   	                  response.response.role == "2"
   	                ) {
   	                  //document.getElementById("member").style.display = "";
   	                }

   	                inner_html +=
   	                  '<li class="dropdown"><a href="#"><span>' +
   	                  response.response.name +
   	                  '</span> <i class="bi bi-chevron-down"></i></a><ul><li><a href="self-info.html">使用者資訊</a></li><li><a id="logout" onclick="Logout()">登出</a></li></ul></li>';
   	              }
   	              $("#loginOrNot").append(inner_html);
   	            }
   	                console.log(response);
   	            },
   	            error: function () {
   	                alert("無法連線到伺服器！");
   	            }
   	    });
     }
     checkLogin();
    function Logout() {
   	    // 發出POST的AJAX請求
   	    $.ajax({
   	      type: "POST",
   	      url: "api/logout.do",
   	      crossDomain: true,
   	      cache: false,
   	      dataType: "json",
   	      timeout: 5000,
   	      success: function (response) {
   	          if(response.status == 200){
   	          }
   	          console.log(response);
   	      },
   	      error: function () {
   	        alert("無法連線到伺服器！");
   	      },
   	    });
   	    window.location.reload();
     };
     //end account function
         // 全域變數紀錄SQL指令下的次數
                var sql_num = 0;
                function deleteBulletinBoard(id) {
                    var check = window.confirm("確認刪除公佈欄？");
                    if (check == true) {
                        console.log("You pressed OK!");
                        var request = {'id': id};
                        var data_string = JSON.stringify(request);
                        $.ajax({
                            type: "DELETE",
                            url: "api/BulletinBoard.do",
                            crossDomain: true,
                            data: data_string,
                            cache: false,
                            dataType: 'json',
                            timeout: 5000,
                            success: function (response) {
                                if(response.status == 200){
                                    $("#flashMessage").html("成功! 已經成功刪除公佈欄...");
                                    $("#flashMessage").show();
                                    getAllBulletinBoard();
                                }
                                console.log(response);
                            },
                            error: function () {
                                alert("無法連線到伺服器！");
                            }
                        });
                    }
                    else {
                        console.log("You pressed Cancel!");
                    }
                }

                function getAllBulletinBoard() {
                    // 發出POST的GET請求取得所有公佈欄列表
                    $.ajax({
                            type: "GET",
                            url: "api/BulletinBoard.do",
                            crossDomain: true,
                            cache: false,
                            dataType: 'json',
                            timeout: 5000,
                            success: function (response) {
                                if(response.status == 200){
                                    updateTable(response.response.data);
                                    updateSQLTable(response.response);
                                }
                                console.log(response);
                            },
                            error: function () {
                                alert("無法連線到伺服器！");
                            }
                    });
                }
                
                // 更新公佈欄列表表格
                function updateTable(data) {
                    $("#table > tbody").empty();
                    var table_html = '';
                    $.each(data, function(index, value) {
                        table_html += '<tr><td scope="row">' + value['id'] + '</td>';
                        table_html += '<td>' + value['topic'] + '</td>';
                        table_html += '<td>' + value['content'] + '</td>';
                        table_html += '<td>' + value['login_times'] + '</td>';
                        table_html += '<td>' + '<a class="btn btn-warning" href="edit_bulletinboard.html?id=' + value['id'] + '">編輯</a> | ';
                        table_html += '<a class="btn btn-danger" href="javascript: deleteBulletinBoard(' + value['id'] + ');">刪除</a></td></tr>';
                    })

                    $("#table > tbody").append(table_html);
                }
                
                // 更新SQL指令歷史表格
                function updateSQLTable(data) {
                    $("#sql_log > tbody").empty();
                    var time = (data.time / 1000000).toFixed(2);
                    var table_html = "";
                    
                    sql_num = 0;
                    sql_num += 1

                    table_html += '<tr>';
                    table_html += '<td>' + sql_num + '</td>';
                    table_html += '<td>' + data.sql + '</td>';
                    table_html += '<td style="text-align: right">' + '0' + '</td>';
                    table_html += '<td style="text-align: right">' + data.row + '</td>';
                    table_html += '<td style="text-align: right">' + data.row + '</td>';
                    table_html += '<td style="text-align: right">' + time + '</td>';
                    table_html += '</tr>';
                    $("#sql_log > tbody").append(table_html);
                    $("#sql_summary").html("(default) " + data.row + " queries took " + time + " ms");
                }
                $(document).ready(function() {
                    getAllBulletinBoard();
                });
                
     </script>
     
    
     
     
   </div>
    <footer id="footer" class="footer">
      <div class="footer-top">
        <div class="container">
          <div class="copyright">
            &copy; Copyright <strong><span>FlexStart</span></strong
            >. All Rights Reserved <br />
            <span class="text-align-center">系統分析與設計_期末專案</span>
            <span class="text-align-center">第17組</span>
          </div>

          <div class="credits">
            <!-- All the links in the footer should remain intact. -->
            <!-- You can delete the links only if you purchased the pro version. -->
            <!-- Licensing information: https://bootstrapmade.com/license/ -->
            <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/flexstart-bootstrap-startup-template/ -->
            Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
          </div>
        </div>
      </div>
    </footer>
    <!-- End Footer -->

    <a
      href="#"
      class="back-to-top d-flex align-items-center justify-content-center"
      ><i class="bi bi-arrow-up-short"></i
    ></a>

    <!-- Vendor JS Files -->
    <script src="statics/vendor/purecounter/purecounter.js"></script>
    <script src="statics/vendor/aos/aos.js"></script>
    <script src="statics/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="statics/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="statics/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="statics/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="statics/vendor/php-email-form/validate.js"></script>

    <!-- Template Main JS File -->
    <script src="statics/js/main.js"></script>
</body>
</html>