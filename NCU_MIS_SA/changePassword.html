<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta
      name="author"
      content="Mark Otto, Jacob Thornton, and Bootstrap contributors"
    />
    <meta name="generator" content="Jekyll v3.8.5" />

    <title>更改密碼 ｜ NCU MIS SA</title>

    <!-- Favicons -->
    <link href="statics/icon/favicon.ico" rel="icon" />
    <link href="statics/img/apple-touch-icon.png" rel="apple-touch-icon" />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link href="statics/vendor/aos/aos.css" rel="stylesheet" />
    <link href="statics/css/profile.css" rel="stylesheet" />
    <link
      href="statics/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="statics/vendor/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      href="statics/vendor/glightbox/css/glightbox.min.css"
      rel="stylesheet"
    />
    <link href="statics/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link href="statics/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />

    <link
      rel="stylesheet"
      href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
      integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p"
      crossorigin="anonymous"
    />
    <script src="statics/js/jquery-3.4.1.min.js"></script>
    <!-- Template Main CSS File -->
    <link href="statics/css/style.css" rel="stylesheet" />

    <!-- =======================================================
  * Template Name: FlexStart - v1.9.0
  * Template URL: https://bootstrapmade.com/flexstart-bootstrap-startup-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
  </head>

  <body>
  <!-- ======= Header ======= -->
    <header id="header" class="header fixed-top">
      <div
        class="container-fluid container-xl d-flex align-items-center justify-content-between"
      >
        <a href="index.html" class="logo d-flex align-items-center">
          <img src="statics/img/logo.png" alt="" />
          <span>宿舍管理系統</span>
        </a>

        <nav id="navbar" class="navbar">
          <ul>
            <li><a class="nav-link scrollto active" href="index.html#hero">首頁</a></li>
            <li><a class="nav-link scrollto" href="index.html#services">選單</a></li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                其他功能
              </a>

              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                <li>
                  <a
                    class="nav-link dropdown-item scrollto"
                    href="index.html#bulletin_board"
                    >公告欄</a
                  >
                </li>
                <li>
                  <a
                    class="nav-link dropdown-item scrollto"
                    href="discussion_board.html"
                    >討論版</a
                  >
                </li>
                <li>
                  <a class="nav-link dropdown-item scrollto" href="payment.html"
                    >宿舍繳費</a
                  >
                </li>
                <li>
                  <a
                    class="nav-link dropdown-item scrollto"
                    href="dormManagement.html"
                    >宿舍報修</a
                  >
                </li>
                <li>
                  <a
                    class="nav-link dropdown-item scrollto"
                    href="check_in.html"
                    >報到手續</a
                  >
                </li>
                <li>
                  <a
                    class="nav-link dropdown-item scrollto"
                    href="check_out.html"
                    >退宿手續</a
                  >
                </li>
                <li>
                  <hr class="dropdown-divider admin" />
                </li>
                <li>
                  <a
                    class="nav-link dropdown-item scrollto admin"
                    href="member.html"
                    >會員管理</a
                  >
                </li>
                <li>
                  <a
                    class="nav-link dropdown-item scrollto admin"
                    href="bulletinboard.html"
                    >公告欄管理</a
                  >
                </li>
              </ul>
            </li>

            <div id="loginOrNot"></div>
          </ul>
          <i class="bi bi-list mobile-nav-toggle"></i>
        </nav>
        <!-- .navbar -->
      </div>
    </header>
    <!-- End Header -->

    <!-- ======= Hero Section ======= -->
    <section>
      <div class="container">
        <div class="discussion_board">
          <div class="row">
            <div class="col-md-9">
              <div class="container content clear-fix">
                <h2 class="mt-5 mb-5">更改密碼</h2>

                <div class="row" style="height: 100%">
                  <div class="col-md-3">
                    <div href="#" class="d-inline">
                      <img
                        src="statics/img/people.png"
                        width="130px"
                        style="margin: 0"
                      /><br />
                    </div>
                  </div>

                  <div id="content" class="col-md-9">
                    <div class="container">
                      <div class="row">
                        <div
                          id="flashMessage"
                          class="message"
                          style="display: none"
                        ></div>

                        <form id="form" accept-charset="utf-8">
                          <div style="display: none">
                            <input type="hidden" name="_method" value="POST" />
                          </div>
                          <div class="form-group">
                            <div class="col-12">
                              <label for="member_id">編號</label>
                            </div>
                            <div class="col-12">
                              <input
                                name="name"
                                maxlength="30"
                                type="text"
                                id="member_id"
                                required="required"
                                disabled
                              />

                              <!-- <span id="member_id"></span> -->
                            </div>
                          </div>

                          <div class="form-group">
                            <div class="col-12">
                              <label for="member_name">成員名稱</label>
                            </div>
                            <div class="col-12">
                              <input
                                name="name"
                                maxlength="30"
                                type="text"
                                id="member_name"
                                required="required"
                                disabled
                              />
                            </div>
                          </div>

                          <div class="input text required form-group">
                            <div class="col-12">
                              <label for="member_email">電子郵件</label>
                            </div>
                            <div class="col-12">
                              <input
                                name="email"
                                maxlength="50"
                                type="email"
                                id="member_email"
                                required="required"
                                disabled
                              />
                            </div>
                          </div>

                          <div class="input password required form-group">
                            <div class="col-12">
                              <label for="member_password">密碼: </label>
                            </div>
                            <div class="col-12">
                              <input
                                name="password"
                                maxlength="30"
                                type="password"
                                id="member_password"
                                required="required"
                              />
                            </div>
                          </div>

                          <div class="input password required form-group">
                            <div class="col-12">
                              <label for="member_password">確認密碼 </label>
                            </div>
                            <div class="col-12">
                              <input
                                name="password_check"
                                maxlength="30"
                                type="password"
                                id="member_password_check"
                                required="required"
                              />
                            </div>
                          </div>

                          <div class="form-group">
                            <div class="col-12">
                              <label for="member_role">成員身分</label>
                            </div>
                            <div class="col-12">
                              <input
                                name="member_role"
                                maxlength="30"
                                type="text"
                                id="member_role"
                                required="required"
                                disabled
                              />
                            </div>
                          </div>

                          <div class="row mt-5">
                            <div class="col">
                              <div class="submit">
                                <a
                                  type="button"
                                  class="btn btn-primary"
                                  id="submit"
                                >
                                  更改密碼
                                </a>
                              </div>
                            </div>

                            <div class="col">
                              <a
                                onclick="redirect_2_self()"
                                type="button"
                                class="btn btn-default btn-block"
                              >
                                回使用者頁面
                              </a>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- End Hero -->
    <script>
            var url_string = window.location.href;
            var url = new URL(url_string);
            var id = url.searchParams.get("id");
            var name = "";

            //redirect to parent page
            function redirect_2_self() {
              window.location.href = "self-info.html";
            }

            //account function
            function checkLogin() {
              $.ajax({
                type: "GET",
                url: "api/login.do",
                crossDomain: true,
                cache: false,
                dataType: "json",
                timeout: 5000,
                success: function (response) {
                  if (response.status == 200) {
                	  $(".admin").hide();
                    let inner_html = "";
                    if (response.response.status != "login") {
                      //未登入
                      inner_html +=
                        '<li class="nav-item"><a class="getstarted scrollto" href="login.html">登入</a></li>';
                    } else {
                      //登入
                      if (
                        // 0->宿民 1->宿舍負責人 2->宿舍舍監 3->外聘廠商
                        response.response.role == "1" ||
                        response.response.role == "2"
                      ) {
                          $(".admin").show();
                      }

                      $('#member_email').val(response.response.email);
                      $('#member_id').val(response.response.id);
                      $('#member_name').val(response.response.name);


                      if (response.response.role == 0) {
                        $('#member_role').val("宿民");
                    } else if (response.response.role == 1) {
                          $('#member_role').val("宿舍負責人");
                        } else if (response.response.role == 2) {
                          $('#member_role').val("宿舍舍監");
                        } else if (response.response.role == 3) {
                          $('#member_role').val("外聘廠商");

                      }

                      inner_html +=
                        '<li class="dropdown"><a href="#"><span>' +
                        response.response.name +
                        '</span> <i class="bi bi-chevron-down"></i></a><ul><li><a href="self-info.html">使用者資訊</a></li><li><a id="logout" onclick="Logout()">登出</a></li></ul></li>';
                    }
                    $("#loginOrNot").append(inner_html);
                  }
                  console.log(response);
                },
                error: function () {
                  alert("無法連線到伺服器！");
                },
              });
            }
            checkLogin();

            function Logout() {
              // 發出POST的AJAX請求
              $.ajax({
                type: "POST",
                url: "api/logout.do",
                crossDomain: true,
                cache: false,
                dataType: "json",
                timeout: 5000,
                success: function (response) {
                  if (response.status == 200) {
                  }
                  //console.log(response);
                },
                error: function () {
                  alert("無法連線到伺服器！");
                },
              });
              window.location.reload();
            }
            //end account function
            var $form = $('#submit');
            $form.click(function() {
                submit();
            });

      function submit() {
          var name = $('#member_name').val();
          var email = $('#member_email').val();
          var password = $('#member_password').val();
          var password_check = $('#member_password_check').val();

          var email_rule = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/;
          var password_rule = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;

      	if(password!=password_check){
          	alert("請輸入同樣的密碼!");
              $('#member_password').val()="";
              $('#member_password_check').val()="";
          }
          else if(!password_rule.test(password)) {
              alert("密碼格式不符，長度至少8，且至少包含一個數字和英文字母！");
          }

          else {
              // 將資料組成JSON格式
              var data_object = {
                  "name": name,
                  "email": email,
                  "password": password
              };

              // 將JSON格式轉換成字串
              var data_string = JSON.stringify(data_object);

              // 發出POST的AJAX請求
              $.ajax({
                      type: "POST",
                      url: "api/member2.do",
                      data: data_string,
                      crossDomain: true,
                      cache: false,
                      dataType: 'json',
                      timeout: 5000,
                      success: function (response) {
                          alert(response.message);
                          if(response.status == 200){
                         		window.location = "login.html";
                          }
                      },
                      error: function () {
                          alert("無法連線到伺服器！");
                      }
              });
          }
      }
    </script>

    <footer id="footer" class="footer">
      <div class="footer-top">
        <div class="container">
          <div class="copyright">
            &copy; Copyright <strong><span>FlexStart</span></strong
            >. All Rights Reserved <br />
            <span class="text-align-center">系統分析與設計_期末專案</span>
            <span class="text-align-center">第17組</span>
          </div>

          <div class="credits">
            <!-- All the links in the footer should remain intact. -->
            <!-- You can delete the links only if you purchased the pro version. -->
            <!-- Licensing information: https://bootstrapmade.com/license/ -->
            <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/flexstart-bootstrap-startup-template/ -->
            Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
          </div>
        </div>
      </div>
    </footer>
    <!-- End Footer -->

    <a
      href="#"
      class="back-to-top d-flex align-items-center justify-content-center"
      ><i class="bi bi-arrow-up-short"></i
    ></a>

    <!-- Vendor JS Files -->
    <script src="statics/vendor/purecounter/purecounter.js"></script>
    <script src="statics/vendor/aos/aos.js"></script>
    <script src="statics/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="statics/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="statics/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="statics/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="statics/vendor/php-email-form/validate.js"></script>

    <!-- Template Main JS File -->
    <script src="statics/js/main.js"></script>
  </body>
</html>
